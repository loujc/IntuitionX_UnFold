# 视频智能解析功能 - 使用说明

## ✅ 已完成的功能

### 1. 视频播放器集成
- ✅ 将静态图片替换为 `<video>` 元素
- ✅ 添加播放控制条
- ✅ 实时监听播放时间（video.currentTime）

### 2. 自动弹窗知识卡片
- ✅ 基于播放时间自动触发
- ✅ framer-motion 淡入淡出动画
- ✅ 小白/深度模式切换
- ✅ 3秒自动消失
- ✅ 手动关闭按钮

### 3. 侧边栏段落联动
- ✅ 根据当前播放时间高亮对应段落
- ✅ 点击段落跳转到对应时间点
- ✅ 实时显示时间范围

### 4. 明朝历史数据
- ✅ 6个知识卡片触发点
- ✅ 3个视频段落标记
- ✅ 完整的时间轴数据结构

---

## 📁 文件结构

```
frontend/
├── src/
│   ├── App.tsx                          # ✅ 已修改 - 主应用和 DetailPage
│   ├── components/
│   │   ├── ExpandedPanel.tsx            # ✅ 已重构 - 侧边栏段落
│   │   └── KnowledgeCard.tsx            # ✅ 已重构 - 知识卡片
│   └── data/
│       └── videoTimelineData.ts         # ✅ 新增 - 时间轴数据
└── public/
    └── video.mp4                        # ⚠️ 需要你手动放置
```

---

## 🚀 部署步骤

### 第1步：放置视频文件

**请将你的明朝历史视频文件移动到以下位置：**

```bash
D:\inhacken\demo1\IntuitionX_UnFold\frontend\public\video.mp4
```

**如果文件不存在，需要创建 public 目录：**

```bash
cd D:\inhacken\demo1\IntuitionX_UnFold\frontend
mkdir public
# 然后将 D:\inhacken\demo1\video.mp4 复制到 public 目录
```

### 第2步：安装依赖（如果还没安装）

```bash
npm install
```

### 第3步：运行开发服务器

```bash
npm run dev
```

浏览器会自动打开 `http://localhost:3000`

---

## 🎮 使用指南

### 进入详情页
1. 启动应用后，点击 "Start" 按钮
2. 在首页点击任意视频卡片
3. 进入详情页（DetailPage）

### 播放视频
- 视频会自动加载，使用浏览器原生控制条播放
- 播放时会自动监听 currentTime

### 自动弹窗功能
当视频播放到以下时间点时，会自动弹出知识卡片：

| 时间 | 关键词 | 触发说明 |
|------|--------|----------|
| 0:05 | 永乐大帝 | 首个卡片，介绍明成祖朱棣 |
| 0:11 | 于谦 | 北京保卫战英雄 |
| 0:13 | 瓦剌留学生 | 土木堡之变梗 |
| 1:21 | 胡惟庸案/废除丞相 | 朱元璋集权 |
| 1:40 | 锦衣卫 | 特务机构介绍 |
| 2:07 | 洪武之治 | 总结卡片 |

**卡片行为：**
- 自动淡入显示
- 3秒后自动消失
- 可点击"×"手动关闭
- 可切换"小白/深度"模式查看不同内容

### 侧边栏交互
1. 点击视频左侧的**三角形展开按钮**打开侧边栏
2. 侧边栏显示3个历史段落：
   - 朱元璋崛起 (0:25-1:00)
   - 朱元璋成长史 (1:00-1:48)
   - 恢复元气/减免赋税 (1:48-1:57)
3. **当前播放段落会高亮显示**（红点标记+红色文字）
4. **点击任意段落可跳转到对应时间**

---

## 🎨 交互特性

### 知识卡片动画
- **进入动画**: 从下方淡入 + 缩放 (0.3秒)
- **退出动画**: 向上淡出 + 缩放 (0.3秒)
- **切换动画**: 小白/深度模式平滑过渡

### 侧边栏高亮
- **活跃段落**: 红色圆点 + 红色加粗标题
- **非活跃段落**: 白色圆点 + 黑色标题
- **悬停效果**: scale 1.02 放大

### 视频控制
- 浏览器原生控制条
- 支持暂停、快进、音量调节
- 支持全屏播放

---

## 🔧 自定义配置

### 修改知识卡片数据

编辑 `src/data/videoTimelineData.ts`:

```typescript
export const knowledgeCards: KnowledgeCardData[] = [
  {
    time: 5,  // 触发时间（秒）
    word: "永乐大帝",  // 关键词
    simple: "明成祖朱棣，靖难之役后的铁血皇帝。",  // 小白模式文案
    deep: "明成祖（1360－1424），开创永乐盛世..."  // 深度模式文案
  },
  // 添加更多...
];
```

### 修改视频段落

编辑 `src/data/videoTimelineData.ts`:

```typescript
export const videoSegments: VideoSegmentData[] = [
  {
    startTime: 25,  // 开始时间（秒）
    endTime: 60,    // 结束时间（秒）
    title: "朱元璋崛起",  // 段落标题
    description: "从放牛娃到开国皇帝..."  // 段落描述
  },
  // 添加更多...
];
```

### 调整触发容差

在 `src/data/videoTimelineData.ts` 中的 `findActiveKnowledgeCard` 函数：

```typescript
export const findActiveKnowledgeCard = (
  currentTime: number,
  tolerance: number = 0.5  // 默认0.5秒容差，可调整为 1.0 或更大
): KnowledgeCardData | null => {
  // ...
};
```

### 修改卡片自动消失时间

在 `App.tsx` 的 DetailPage 组件中：

```typescript
// 3秒后自动隐藏
setTimeout(() => {
  setShowKnowledgeCard(false);
}, 3000);  // 改为 5000 = 5秒
```

---

## 🐛 故障排查

### 问题1: 视频无法加载
**症状**: 显示"您的浏览器不支持视频播放"

**解决方案**:
1. 检查 `public/video.mp4` 文件是否存在
2. 确保视频格式为 MP4 (H.264编码)
3. 检查浏览器控制台是否有路径错误

### 问题2: 知识卡片不弹出
**症状**: 播放到触发时间点时没有反应

**解决方案**:
1. 打开浏览器开发者工具的 Console
2. 检查是否有 JavaScript 错误
3. 确认 `videoTimelineData.ts` 数据正确导入
4. 检查视频是否真的在播放（currentTime 是否在增加）

### 问题3: 侧边栏不高亮
**症状**: 播放时段落不高亮

**解决方案**:
1. 确保点击了展开按钮打开侧边栏
2. 检查 `videoSegments` 的时间范围是否正确
3. 确认 currentTime 在段落的 startTime 和 endTime 之间

### 问题4: 点击段落无法跳转
**症状**: 点击侧边栏段落后视频时间不变

**解决方案**:
1. 检查浏览器控制台是否有错误
2. 确认 `handleSeekTo` 函数是否正确传递
3. 检查 video ref 是否正确绑定

---

## 📊 数据结构说明

### KnowledgeCardData (知识卡片)
```typescript
{
  time: number;       // 触发时间（秒）
  word: string;       // 关键词（如"永乐大帝"）
  simple: string;     // 小白模式文案
  deep: string;       // 深度模式文案
}
```

### VideoSegmentData (视频段落)
```typescript
{
  startTime: number;  // 段落开始时间（秒）
  endTime: number;    // 段落结束时间（秒）
  title: string;      // 段落标题
  description: string; // 段落描述
}
```

---

## 🎯 技术实现细节

### 时间监听机制
```typescript
useEffect(() => {
  const videoElement = videoRef.current;
  const handleTimeUpdate = () => {
    const time = videoElement.currentTime;
    setCurrentTime(time);

    // 检查知识卡片触发
    const card = findActiveKnowledgeCard(time);
    if (card && card !== activeKnowledgeCard) {
      setShowKnowledgeCard(true);
    }
  };

  videoElement.addEventListener('timeupdate', handleTimeUpdate);
  return () => videoElement.removeEventListener('timeupdate', handleTimeUpdate);
}, []);
```

### 段落高亮逻辑
```typescript
const isSegmentActive = (segment) => {
  return currentTime >= segment.startTime && currentTime <= segment.endTime;
};
```

### 视频跳转实现
```typescript
const handleSeekTo = (time: number) => {
  if (videoRef.current) {
    videoRef.current.currentTime = time;
  }
};
```

---

## 🌟 未来扩展方向

### 可添加的功能
- [ ] 用户标记功能（添加自定义时间点标记）
- [ ] 笔记导出（导出所有段落和知识点为 Markdown）
- [ ] 视频字幕显示（.srt 文件解析）
- [ ] 播放速度调节（0.5x, 1x, 1.5x, 2x）
- [ ] 关键帧缩略图预览
- [ ] 知识点搜索功能
- [ ] 多视频管理（切换不同历史主题）

### 数据增强
- [ ] 添加更多历史朝代视频
- [ ] 引入历史人物关系图
- [ ] 集成历史事件时间轴
- [ ] 添加历史地图展示

---

## 📞 技术支持

如有问题，请检查：
1. Node.js 版本 >= 16
2. npm 包是否完整安装
3. 浏览器是否支持 HTML5 video
4. 视频文件格式是否正确

---

**祝你使用愉快！ 🎉**
